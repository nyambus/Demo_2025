# Модуль 2
## 2. Конфигурация файлового хранилища (RAID5 NFS)

---

### 2.1 Создание дисков в Proxmox


### 2.2 Настройка RAID5

Скачиваем утилиту mdadm:
```
apt install mdadm -y
```
Проверяем, установилась ли утилита при помощи вывода ее версии:
```
sudo mdadm -V
```
Прописываем lsblk, смотрим названия созданных ранее дисков по 1 гб:
```
lsblk
```
После создаем RAID5-массив, указывая `название` устройства, которое необходимо создать (md0), `уровень RAID`, `количество устройств` в создаваемом RAID-массиве и сами `устройства` (sda, sdb, sdc и т.д.):
```
mdadm --create --verbose /dev/md0 --level=5 --raid-devices=3 /dev/sdb /dev/sdc /dev/sdd
```
Сканируем созданный массив и добавляем данные в файл конфигурации:
```
mdadm --detail --scan > /etc/mdadm/mdadm.conf
```
После этого обновляем initramfs, чтобы массив был доступен во время загрузки:
```
update-initramfs -u
```
Создаем в массиве файловую систему:
```
mkfs.ext4 -F /dev/md0
```
Создаем директорию, в которую далее будем монтировать RAID-массив (`-p` создает директорию, если ее не существует):
```
mkdir -p /raid5
```
Монтируем созданную ранее файловую систему в директорию `/raid5`:
```
mount /dev/md0 /raid5
```
Добавляем новые параметры монтирования файловой системы в файл /etc/fstab для поддержки автоматического монтирования при загрузке:
```
echo '/dev/md0 /raid5 ext4 defaults,nofail,discard 0 0' >> /etc/fstab
```
Перезагружаемся (`reboot`) и проверяем, что raid5 активен:
```
cat /proc/mdstat
```

### 2.3.1 Настройка NFS на HQ-SRV

Устанавливаем nfs-сервер:
```
apt install nfs-kernel-server
```
Создаем директорию для монтирования
```
mkdir -p /raid5/nfs
```
qewqeqweqweqw!!!!
```
chown -R nobody:nogroup /raid5/nfs
```
Открываем файл конфигурации экспортируемых файловых систем:
```
nano /etc/exports
```
Добавляем строку в конец файла:
```
/raid5/nfs *(rw,sync,no_subtree_check)
```
Выполняем команду для применения настроек:
```
exportfs -a
```
Перезагружаем nfs-сервер:
```
systemctl restart nfs-kernel-server
```

### 2.3.2 Настройка NFS на HQ-CLI

Устанавливаем пакета для клиента nfs:
```
apt install nfs-common -y
```
Создаем директорию для монтирования сетевой файловой системы:
```
mkdir -p /mnt/nfs
```
Монтируем сетевую файловую систему:
```
mount -t nfs4 192.168.100.10:/raid5/nfs /mnt/nfs
```
Добавляем строку в конец файла `/etc/fstab/`:
```
echo '192.168.100.10:/raid5/nfs /mnt/nfs nfs defaults 0 0' >> /etc/fstab/
```
`??? либо через mount -a монтируем все из fstab вместо mount -t парой команд выше`
